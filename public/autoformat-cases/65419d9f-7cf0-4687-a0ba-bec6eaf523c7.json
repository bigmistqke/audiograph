{
  "id": "65419d9f-7cf0-4687-a0ba-bec6eaf523c7",
  "title": "Secondary root pulls left to fit chain before shared merge",
  "comments": [
    {
      "role": "assistant",
      "text": "Two roots: A (no inputs, one output to B) and C (no inputs, one output to D). B is a merge node (inputs from A and D). Chain [A,B] and chain [C,D,B] (D is last internal before merge B).\n\nPer spec, the topmost root (smallest y) is chosen as the primary anchor. A is at y=0, C is at y=130 — A is primary.\n\nA stays at (0,0). B.x = max(A.right, D.right) + gap. Forward pass: D.x must be resolved first via chain [C,D,B]. Backward pass: D is last internal before B, so D.x = max(C.right+gap, B.x−D.width−gap). With B.x=130: D.x = max(0, 0) = 0. Then C.x = D.x − C.width − gap = 0 − 100 − 30 = −130.\n\nC ends up at negative x — the layout freely extends leftward. C and D go to row 1 (y=110).\n\nRule tested: multi-root layout — secondary root is placed in a lower row and can extend into negative x coordinates."
    }
  ],
  "initial": {
    "nodes": {
      "A": {
        "id": "A",
        "type": "node",
        "x": 0,
        "y": 0,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "B": {
        "id": "B",
        "type": "node",
        "x": 280,
        "y": 20,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "C": {
        "id": "C",
        "type": "node",
        "x": 30,
        "y": 130,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "D": {
        "id": "D",
        "type": "node",
        "x": 170,
        "y": 150,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      }
    },
    "edges": [
      {
        "output": {
          "node": "A",
          "port": "out"
        },
        "input": {
          "node": "B",
          "port": "in"
        }
      },
      {
        "output": {
          "node": "D",
          "port": "out"
        },
        "input": {
          "node": "B",
          "port": "in"
        }
      },
      {
        "output": {
          "node": "C",
          "port": "out"
        },
        "input": {
          "node": "D",
          "port": "in"
        }
      }
    ]
  },
  "expected": {
    "nodes": {
      "A": {
        "id": "A",
        "type": "node",
        "x": 0,
        "y": 0,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "B": {
        "id": "B",
        "type": "node",
        "x": 130,
        "y": 0,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "C": {
        "id": "C",
        "type": "node",
        "x": -130,
        "y": 110,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      },
      "D": {
        "id": "D",
        "type": "node",
        "x": 0,
        "y": 110,
        "dimensions": {
          "x": 100,
          "y": 80
        }
      }
    },
    "edges": [
      {
        "output": {
          "node": "C",
          "port": "out"
        },
        "input": {
          "node": "D",
          "port": "in"
        }
      },
      {
        "output": {
          "node": "D",
          "port": "out"
        },
        "input": {
          "node": "B",
          "port": "in"
        }
      },
      {
        "output": {
          "node": "A",
          "port": "out"
        },
        "input": {
          "node": "B",
          "port": "in"
        }
      }
    ]
  }
}